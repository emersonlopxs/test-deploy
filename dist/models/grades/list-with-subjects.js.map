{"version":3,"sources":["../../../src/models/grades/list-with-subjects.js"],"names":["listWithSubjects","query","limit","offset","sql","sqlTotal","rows","total","Promise","all"],"mappings":";;;;;;;AAAA;;AAEO,MAAMA,gBAAgB,GAAG,OAAO;AAAEC,EAAAA,KAAF;AAASC,EAAAA,KAAK,GAAG,EAAjB;AAAqBC,EAAAA,MAAM,GAAG;AAA9B,CAAP,KAA6C;AAC3E,QAAMC,GAAG,GAAI;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMH,KAAK,GAAI,qBAAoB,oBAAKA,KAAL,CAAY,mBAAkB,oBAAKA,KAAL,CAAY,IAAlE,GAAwE,EAAG;AACtF,GAZE;AAcA,QAAMI,QAAQ,GAAI,kCAAiCD,GAAI,QAAvD;AAEA,QAAM,CAACE,IAAD,EAAO,CAAC;AAAEC,IAAAA;AAAF,GAAD,CAAP,IAAsB,MAAMC,OAAO,CAACC,GAAR,CAAY,CAAC,sBAAOL,GAAP,CAAD,EAAc,sBAAOC,QAAP,CAAd,CAAZ,CAAlC;AAEA,SAAO;AAAEJ,IAAAA,KAAF;AAASC,IAAAA,KAAT;AAAgBC,IAAAA,MAAhB;AAAwBI,IAAAA,KAAxB;AAA+BD,IAAAA;AAA/B,GAAP;AACD,CApBM","sourcesContent":["import { select, like } from \"~/core/database\";\n\nexport const listWithSubjects = async ({ query, limit = 10, offset = 0 }) => {\n  const sql = `\n    select\n      sg.gradeId\n      , sg.subjectId\n      , g.name as gradeName\n      , s.name as subjectName\n      , s.color as subjectColor\n    from subjectsGrades as sg\n    inner join grades as g on g.id = sg.gradeId\n    inner join subjects as s on s.id = sg.subjectId\n    where 1 = 1\n    ${query ? `and ( g.name like ${like(query)} or s.name like ${like(query)} )` : \"\"}\n  `;\n\n  const sqlTotal = `select count(*) as total from (${sql}) as t`;\n\n  const [rows, [{ total }]] = await Promise.all([select(sql), select(sqlTotal)]);\n\n  return { query, limit, offset, total, rows };\n};\n"],"file":"list-with-subjects.js"}