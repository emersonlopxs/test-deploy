{"version":3,"sources":["../../../src/models/class-types/list-subjects.js"],"names":["listSubjects","classTypeId","siteIds","keyword","limit","offset","rows","join","count","total"],"mappings":";;;;;;;AAAA;;AAEO,MAAMA,YAAY,GAAG,OAAO;AAAEC,EAAAA,WAAF;AAAeC,EAAAA,OAAf;AAAwBC,EAAAA,OAAxB;AAAiCC,EAAAA,KAAK,GAAG,EAAzC;AAA6CC,EAAAA,MAAM,GAAG;AAAtD,CAAP,KAAqE;AAC/F,QAAMC,IAAI,GAAG,MAAM,sBAChB;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQJ,OAAO,GAAI,oBAAmBA,OAAO,CAACK,IAAR,EAAe,GAAtC,GAA2C,EAAG;AAC7D,QAAQJ,OAAO,GAAI,mBAAkB,oBAAKA,OAAL,CAAc,EAApC,GAAwC,EAAG;AAC1D;AACA;AACA;AACA;AACA;AACA,KAnBqB,EAoBjB,CAACF,WAAD,EAAcG,KAAd,EAAqBC,MAArB,CApBiB,CAAnB;AAuBA,QAAM;AAAEG,IAAAA,KAAK,EAAEC;AAAT,MAAmB,MAAM,qBAC5B;AACL;AACA;AACA;AACA,QAAQP,OAAO,GAAI,oBAAmBA,OAAO,CAACK,IAAR,EAAe,GAAtC,GAA2C,EAAG;AAC7D,QAAQJ,OAAO,GAAI,mBAAkB,oBAAKA,OAAL,CAAc,EAApC,GAAwC,EAAG;AAC1D;AACA;AACA;AACA,KAViC,EAW7B,CAACF,WAAD,CAX6B,CAA/B;AAcA,SAAO;AAAEG,IAAAA,KAAF;AAASC,IAAAA,MAAT;AAAiBI,IAAAA,KAAjB;AAAwBH,IAAAA;AAAxB,GAAP;AACD,CAvCM","sourcesContent":["import { select, first, like } from \"~/core/database\";\n\nexport const listSubjects = async ({ classTypeId, siteIds, keyword, limit = 10, offset = 0 }) => {\n  const rows = await select(\n    `\n    select\n      S.id,\n      S.name,\n      S.color,\n      S.description,\n      (select count(*) as count\n    from classesSubjects as CS\n    where CS.subjectId = S.id) as classQuantity\n    from subjects as S\n    where classTypeId = ?\n      ${siteIds ? `AND S.siteId in (${siteIds.join()})` : \"\"}\n      ${keyword ? `AND S.name like ${like(keyword)}` : \"\"}\n      AND (select count(*) as count\n      from classesSubjects as CS\n      where CS.subjectId = S.id) > 0\n    order by S.modified_at desc\n    limit ? offset ?\n    `,\n    [classTypeId, limit, offset]\n  );\n\n  const { count: total } = await first(\n    `\n    select count(*) as count\n    from subjects as S\n    where classTypeId = ?\n      ${siteIds ? `AND S.siteId in (${siteIds.join()})` : \"\"}\n      ${keyword ? `AND S.name like ${like(keyword)}` : \"\"}\n      AND (select count(*) as count\n      from classesSubjects as CS\n      where CS.subjectId = S.id) > 0\n    `,\n    [classTypeId]\n  );\n\n  return { limit, offset, total, rows };\n};\n"],"file":"list-subjects.js"}