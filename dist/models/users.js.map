{"version":3,"sources":["../../src/models/users.js"],"names":["getCredentialsInfo","username","getRoleInfo","role","userId","queries","teacher","student","admin","mentor","updatePassword","password"],"mappings":";;;;;;;AAAA;;AAEO,MAAMA,kBAAkB,GAAG,OAAMC,QAAN,KAChC,qBACG;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAhBE,EAiBE,CAACA,QAAD,CAjBF,CADK;;;;AAqBA,MAAMC,WAAW,GAAG,CAACC,IAAD,EAAOC,MAAP,KAAkB;AAC3C,QAAMC,OAAO,GAAG;AACdC,IAAAA,OAAO,EAAG;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAtBkB;AAuBdC,IAAAA,OAAO,EAAG;AACd;AACA;AACA;AACA;AACA;AACA,OA7BkB;AA8BdC,IAAAA,KAAK,EAAG;AACZ;AACA;AACA;AACA;AACA,MAnCkB;AAoCdC,IAAAA,MAAM,EAAG;AACb;AACA;AACA;AACA;AACA;AAzCkB,GAAhB;AA4CA,SAAO,qBAAMJ,OAAO,CAACF,IAAD,CAAb,EAAqB,CAACC,MAAD,CAArB,CAAP;AACD,CA9CM;;;;AAgDA,MAAMM,cAAc,GAAG,OAAOT,QAAP,EAAiBU,QAAjB,KAC5B,sBACG;AACL;AACA;AACA;AACA,KALE,EAME,CAACA,QAAD,EAAWV,QAAX,CANF,CADK","sourcesContent":["import { first, update } from \"~/core/database\";\n\nexport const getCredentialsInfo = async username =>\n  first(\n    `\n      select\n        id\n        , username\n        , password\n        , createdAt\n        , modifiedAt\n        , (\n          select alias\n          from usersRoles\n            join roles on roles.id = usersRoles.roleId\n          where userId = users.id\n        ) as role\n      from users\n      where username = ?\n    `,\n    [username]\n  );\n\nexport const getRoleInfo = (role, userId) => {\n  const queries = {\n    teacher: `\n        select\n          t.name\n          , t.state\n          , t.city\n          , t.graduationUniversityName\n          , t.graduationYear\n          , t.workSchoolName\n          , t.ddd\n          , t.telephone\n          , s.id as subjectId\n          , s.name as subjectName\n          , s.color as subjectColor\n        from teachers as t\n        left join (\n          select ts.teacherId, s.id, s.name, s.color\n          from teachersSubjects as ts\n          join subjects as s on s.id = ts.subjectId\n          order by ts.id\n        ) as s on s.teacherId = t.id\n        where t.userId = ?\n     `,\n    student: `\n        select\n          name\n          , gradeId\n        from students\n        where userId = ?\n      `,\n    admin: `\n        select\n          name\n        from admin\n        where userId = ?\n     `,\n    mentor: `\n        select\n          name\n        from mentors\n        where userId = ?\n      `,\n  };\n\n  return first(queries[role], [userId]);\n};\n\nexport const updatePassword = async (username, password) =>\n  update(\n    `\n      update users\n        set password = ?\n      where username = ?\n    `,\n    [password, username]\n  );\n"],"file":"users.js"}