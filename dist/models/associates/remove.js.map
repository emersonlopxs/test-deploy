{"version":3,"sources":["../../../src/models/associates/remove.js"],"names":["remove","id","trans","mimetype","first","then","imageLink","split","blobServiceClient","BlobServiceClient","fromConnectionString","AZURE_STORAGE_CONNECTION_STRING","containerClient","getContainerClient","blockBlobClient","getBlockBlobClient","delete"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEO,MAAMA,MAAM,GAAG,OAAO;AAAEC,EAAAA;AAAF,CAAP,KACpB,gCAAiB,MAAMC,KAAN,IAAe;AAC9B,QAAM,GAAGC,QAAH,IAAe,MAAMD,KAAK,CAC7BE,KADwB,CAEtB;AACT;AACA;AACA;AACA;AACA,SAP+B,EAQvB,CAACH,EAAD,CARuB,EAUxBI,IAVwB,CAUnB,CAAC;AAAEC,IAAAA;AAAF,GAAD,KAAmBA,SAAS,CAACC,KAAV,CAAiB,GAAEN,EAAG,EAAtB,CAVA,CAA3B;;AAYA,QAAMO,iBAAiB,GAAGC,+BAAkBC,oBAAlB,CAAuCC,uCAAvC,CAA1B;;AACA,QAAMC,eAAe,GAAGJ,iBAAiB,CAACK,kBAAlB,CAAqC,mBAArC,CAAxB;AACA,QAAMC,eAAe,GAAGF,eAAe,CAACG,kBAAhB,CAAoC,GAAEd,EAAG,GAAEE,QAAS,EAApD,CAAxB;AACA,QAAMW,eAAe,CAACE,MAAhB,EAAN;AAEA,QAAMd,KAAK,CAACF,MAAN,CAAa,qCAAb,EAAoD,CAACC,EAAD,CAApD,CAAN;AACD,CAnBD,CADK","sourcesContent":["import { BlobServiceClient } from \"@azure/storage-blob\";\nimport { AZURE_STORAGE_CONNECTION_STRING } from \"~/core/config\";\nimport { beginTransaction } from \"~/core/database\";\n\nexport const remove = async ({ id }) =>\n  beginTransaction(async trans => {\n    const [, mimetype] = await trans\n      .first(\n        `\n        select\n          imageLink\n        from associates\n        where id = ?\n        `,\n        [id]\n      )\n      .then(({ imageLink }) => imageLink.split(`${id}`));\n\n    const blobServiceClient = BlobServiceClient.fromConnectionString(AZURE_STORAGE_CONNECTION_STRING);\n    const containerClient = blobServiceClient.getContainerClient(\"associates-images\");\n    const blockBlobClient = containerClient.getBlockBlobClient(`${id}${mimetype}`);\n    await blockBlobClient.delete();\n\n    await trans.remove(\"delete from associates where id = ?\", [id]);\n  });\n"],"file":"remove.js"}