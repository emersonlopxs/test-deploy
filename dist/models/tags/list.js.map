{"version":3,"sources":["../../../src/models/tags/list.js"],"names":["list","query","limit","offset","sql","sqls","select","from","sqlTotal","rows","count","total","Promise","all"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEO,MAAMA,IAAI,GAAG,OAAO;AAAEC,EAAAA,KAAF;AAASC,EAAAA,KAAK,GAAG,EAAjB;AAAqBC,EAAAA,MAAM,GAAG;AAA9B,CAAP,KAA6C;AAC/D,MAAIC,GAAG,GAAI;AACb,MAAMC,IAAI,CAACC,MAAO;AAClB,MAAMD,IAAI,CAACE,IAAK;AAChB,GAHE;AAKAH,EAAAA,GAAG,IAAK;AACV;AACA,UAAUF,KAAM,WAAUC,MAAO;AACjC,GAHE;AAKA,MAAIK,QAAQ,GAAI;AAClB;AACA,IAAIH,IAAI,CAACE,IAAK;AACd,GAHE;;AAKA,MAAIN,KAAJ,EAAW;AACTG,IAAAA,GAAG,IAAK,mBAAkB,oBAAKH,KAAL,CAAY,EAAtC;AACAO,IAAAA,QAAQ,IAAK,mBAAkB,oBAAKP,KAAL,CAAY,EAA3C;AACD;;AAED,QAAM,CAACQ,IAAD,EAAO;AAAEC,IAAAA,KAAK,EAAEC;AAAT,GAAP,IAA2B,MAAMC,OAAO,CAACC,GAAR,CAAY,CAAC,sBAAOT,GAAP,CAAD,EAAc,qBAAMI,QAAN,CAAd,CAAZ,CAAvC;AAEA,SAAO;AAAEP,IAAAA,KAAF;AAASC,IAAAA,KAAT;AAAgBC,IAAAA,MAAhB;AAAwBQ,IAAAA,KAAxB;AAA+BF,IAAAA;AAA/B,GAAP;AACD,CAxBM","sourcesContent":["import { first, select, like } from \"~/core/database\";\nimport * as sqls from \"./sqls\";\n\nexport const list = async ({ query, limit = 10, offset = 0 }) => {\n  let sql = `\n    ${sqls.select}\n    ${sqls.from}\n  `;\n\n  sql += `\n  order by name\n  limit ${limit} offset ${offset}\n  `;\n\n  let sqlTotal = `\n  select count(*) as count\n  ${sqls.from}\n  `;\n\n  if (query) {\n    sql += `where name like ${like(query)}`;\n    sqlTotal += `where name like ${like(query)}`;\n  }\n\n  const [rows, { count: total }] = await Promise.all([select(sql), first(sqlTotal)]);\n\n  return { query, limit, offset, total, rows };\n};\n"],"file":"list.js"}