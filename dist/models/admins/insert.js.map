{"version":3,"sources":["../../../src/models/admins/insert.js"],"names":["insert","email","password","name","token","trans","userId","helpers","hash","DEFAULT_PASSWORD","Promise","all","select","sqls","from","then","results","pop"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AACA;;AAEO,MAAMA,MAAM,GAAG,CAAC;AAAEC,EAAAA,KAAF;AAASC,EAAAA,QAAT;AAAmBC,EAAAA,IAAnB;AAAyBC,EAAAA;AAAzB,CAAD,KACpB,gCAAiB,MAAMC,KAAN,IAAe;AAC9B,QAAMC,MAAM,GAAG,MAAMD,KAAK,CAACL,MAAN,CAClB;AACP;AACA;AACA,OAJyB,EAKnB,CAACC,KAAD,EAAQ,MAAMM,OAAO,CAACL,QAAR,CAAiBM,IAAjB,CAAsBN,QAAQ,IAAIO,wBAAlC,CAAd,EAAmEL,KAAnE,CALmB,CAArB;AAQA,QAAMC,KAAK,CAACL,MAAN,CACH;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAbU,EAcJ,CAACM,MAAD,EAASH,IAAT,CAdI,CAAN;AAiBA,SAAOO,OAAO,CAACC,GAAR,CAAY,CACjBN,KAAK,CAACL,MAAN,CACG;AACT;AACA;AACA,SAJM,EAKE,CAAC,OAAD,EAAUM,MAAV,CALF,CADiB,EAQjBD,KAAK,CAACO,MAAN,CACG;AACT,cAAcC,IAAI,CAACD,MAAO;AAC1B,cAAcC,IAAI,CAACC,IAAK;AACxB;AACA,WALM,EAME,CAACR,MAAD,CANF,CARiB,CAAZ,EAgBJS,IAhBI,CAgBCC,OAAO,IAAIA,OAAO,CAACC,GAAR,EAhBZ,CAAP;AAiBD,CA3CD,CADK","sourcesContent":["\nimport { beginTransaction } from \"~/core/database\";\nimport { DEFAULT_PASSWORD } from \"~/core/config\";\nimport * as helpers from \"~/helpers\";\nimport * as sqls from \"./sqls\";\n\nexport const insert = ({ email, password, name, token }) =>\n  beginTransaction(async trans => {\n    const userId = await trans.insert(\n      `\n        insert into users(username, password, token, createdAt, modifiedAt)\n        values(?, ?, ?, now(), now())\n      `,\n      [email, await helpers.password.hash(password || DEFAULT_PASSWORD), token]\n    );\n\n    await trans.insert(\n      `\n        insert into admin(\n          userId\n          , name\n          , createdAt\n          , modifiedAt\n        ) values(\n          ?\n          , ?\n          , now()\n          , now()\n        )\n      `,\n      [userId, name]\n    );\n\n    return Promise.all([\n      trans.insert(\n        `\n          insert into usersRoles(roleId, userId, createdAt, modifiedAt)\n          values((select id from roles where alias = ?), ?, now(), now())\n        `,\n        [\"admin\", userId]\n      ),\n      trans.select(\n        `\n            ${sqls.select}\n            ${sqls.from}\n            where U.id = ?\n          `,\n        [userId]\n      ),\n    ]).then(results => results.pop());\n  });\n"],"file":"insert.js"}