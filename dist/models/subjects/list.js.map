{"version":3,"sources":["../../../src/models/subjects/list.js"],"names":["list","query","classTypeId","siteIds","limit","offset","rows","join","count","total","filters"],"mappings":";;;;;;;AAAA;;AAEO,MAAMA,IAAI,GAAG,OAAO;AAAEC,EAAAA,KAAF;AAASC,EAAAA,WAAT;AAAsBC,EAAAA,OAAtB;AAA+BC,EAAAA,KAAK,GAAG,EAAvC;AAA2CC,EAAAA,MAAM,GAAG;AAApD,CAAP,KAAmE;AACrF,QAAMC,IAAI,GAAG,MAAM,sBAChB;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAML,KAAK,GAAI,iBAAgB,oBAAKA,KAAL,CAAY,EAAhC,GAAoC,EAAG;AAClD,MAAMC,WAAW,GAAI,qBAAoBA,WAAY,EAApC,GAAwC,EAAG;AAC5D,MAAMC,OAAO,GAAI,kBAAiBA,OAAO,CAACI,IAAR,EAAe,GAApC,GAAyC,EAAG;AACzD;AACA,YAAYH,KAAM,WAAUC,MAAO;AACnC,KAhBqB,CAAnB;AAmBA,QAAM;AAAEG,IAAAA,KAAK,EAAEC;AAAT,MAAmB,MAAM,qBAC5B;AACL;AACA;AACA;AACA;AACA,MAAMR,KAAK,GAAI,iBAAgB,oBAAKA,KAAL,CAAY,EAAhC,GAAoC,EAAG;AAClD,MAAMC,WAAW,GAAI,qBAAoBA,WAAY,EAApC,GAAwC,EAAG;AAC5D,MAAMC,OAAO,GAAI,kBAAiBA,OAAO,CAACI,IAAR,EAAe,GAApC,GAAyC,EAAG;AACzD,KATiC,CAA/B;AAYA,SAAO;AACLH,IAAAA,KADK;AAELC,IAAAA,MAFK;AAGLK,IAAAA,OAAO,EAAE;AAAET,MAAAA,KAAF;AAASC,MAAAA,WAAT;AAAsBC,MAAAA;AAAtB,KAHJ;AAILM,IAAAA,KAJK;AAKLH,IAAAA;AALK,GAAP;AAOD,CAvCM","sourcesContent":["import { first, select, like } from \"~/core/database\";\n\nexport const list = async ({ query, classTypeId, siteIds, limit = 10, offset = 0 }) => {\n  const rows = await select(\n    `\n    select\n      id,\n      name,\n      description,\n      siteId,\n      color,\n      classTypeId\n    from subjects\n    where 1 = 1\n    ${query ? `and name like ${like(query)}` : \"\"}\n    ${classTypeId ? `and classTypeId = ${classTypeId}` : \"\"}\n    ${siteIds ? `AND siteId in (${siteIds.join()})` : \"\"}\n    order by modified_at desc\n    limit ${limit} offset ${offset}\n    `\n  );\n\n  const { count: total } = await first(\n    `\n    select\n      count(*) as count\n    from subjects\n    where 1 = 1\n    ${query ? `and name like ${like(query)}` : \"\"}\n    ${classTypeId ? `and classTypeId = ${classTypeId}` : \"\"}\n    ${siteIds ? `AND siteId in (${siteIds.join()})` : \"\"}\n    `\n  );\n\n  return {\n    limit,\n    offset,\n    filters: { query, classTypeId, siteIds },\n    total,\n    rows,\n  };\n};\n"],"file":"list.js"}